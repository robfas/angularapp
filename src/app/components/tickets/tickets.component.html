<body style="background-color: rgb(226, 231, 236)">
<div *ngIf="tableVisible" class="card card-body mb-3 bg-transparent" style="padding-top: 70px; border: transparent">
  <div class="card card-body mb-3" style=" border-color:darkgray;
  box-shadow: 10px 10px 5px #aaaaaa;   ">
  <h3>Segnalazioni</h3>
  <div class="col-sm-14">
  <button type="button" class="btn btn-dark float-right" (click)="showArchived()">
      Archiviate
  </button>
</div>
<table id="elencotickets"  class="table table-hover dt-responsive" cellspacing="0" width="100%">                                       
    <thead>
        <tr >
            <th style="text-align:center;"class="never">Numero</th>
            <th style="text-align:center;">Data apertura</th>
            <th style="text-align:center;">Titolo</th>
            <th style="text-align:center;">Edificio</th>
            <th style="text-align:center;">Aula</th>
            <th style="text-align:center;">Docente</th>
            <th style="text-align:center;">Stato</th>
            <th style="text-align:center;">Dettagli</th>
            <th style="text-align:center;"></th>
        </tr>
    </thead>
    <tbody>                                                                                         
      <tr *ngFor="let t of tickets;let i = index;"> 
        <td style="text-align:center;"> {{ t.id }} </td>
        <td style="text-align:center;"> {{ t.date  | date: 'dd/MM/yyyy HH:mm'  }} </td> 
        <td style="text-align:center;"><b>{{ t.title }}</b></td>
        <td style="text-align:center;"> {{ t.classroom.building.name }} </td> 
        <td style="text-align:center;"> {{ t.classroom.name }} </td>
        <td style="text-align:center;"> {{ t.teacher.surname }} {{ t.teacher.name }}</td> 
        <td style="text-align:center;"> {{ t.ticketStatus.description }} </td>
        <td style="text-align:center;"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/searchicon.png" alt="Visualizza" height="30" width="30" onclick="" /></a></td>
        <td  *ngIf="t.ticketmessages.length%2!==0" style="text-align:center;"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/exlam.png" height="30" width="30" onclick=""  /></a></td>
    </tr>
    </tbody>
</table>
</div>
</div>

<div *ngIf="tableArchivedVisible" class="card card-body mb-3 bg-transparent" style="padding-top: 70px; border: transparent">
    <div class="card card-body mb-3" style=" border-color:darkgray;
  box-shadow: 10px 10px 5px #aaaaaa;   ">
    <h3>Segnalazioni</h3>
    <div class="col-sm-14">
      <button type="button" class="btn btn-dark float-right" style="float: right;" (click)="ngOnInit()">
          Indietro
      </button>
    </div>
<table id="elencoarchivedtickets"  class="table table-hover dt-responsive" cellspacing="0" width="100%">                                       
      <thead>
              <tr>
                  <th style="text-align:center;" class="never">Numero</th>
                  <th style="text-align:center;">Data apertura</th>
                  <th style="text-align:center;">Titolo</th>
                  <th style="text-align:center;">Edificio</th>
                  <th style="text-align:center;">Aula</th>
                  <th style="text-align:center;">Docente</th>
                  <th style="text-align:center;">Stato</th>
                  <th style="text-align:center;">Dettagli</th>
              </tr>
          </thead>
          <tbody>                                                                                         
                  <tr *ngFor="let t of filteredtickets"> 
                    <td style="text-align:center;"> {{ t.id }} </td>
                    <td style="text-align:center;"> {{ t.date  | date: 'dd/MM/yyyy HH:mm'  }} </td> 
                    <td style="text-align:center;"> {{ t.title }} </td>
                    <td style="text-align:center;"> {{ t.classroom.building.name }} </td> 
                    <td style="text-align:center;"> {{ t.classroom.name }} </td>
                    <td style="text-align:center;"> {{ t.teacher.surname }} {{ t.teacher.name }}</td> 
                    <td style="text-align:center;"> {{ t.ticketStatus.description }} </td>
                    <td style="text-align:center;"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/searchicon.png" alt="Visualizza" height="30" width="30" onclick="" /></a></td>
                  </tr>
                </tbody>
  </table>
  </div>
</div>

<div *ngIf="teacherTable" class="card card-body mb-3 bg-transparent" style="padding-top: 70px; border: transparent">
    <div class="card card-body mb-3" style=" border-color:darkgray;
    box-shadow: 10px 10px 5px #aaaaaa;   ">
            <h3>Segnalazioni Effettuate</h3>
            <div class="col-sm-14">
            <button type="button" class="btn btn-dark float-right" (click)=showArchivedTeacher()>
                Archiviate
            </button>
          </div>
          <table id="elencotickets" class="table table-hover dt-responsive" cellspacing="0" width="100%">                                       
              <thead>
                  <tr>
                      <th style="text-align:center;" class="never">Numero</th>
                      <th style="text-align:center;">Data apertura</th>
                      <th style="text-align:center;">Titolo</th>
                      <th style="text-align:center;">Edificio</th>
                      <th style="text-align:center;">Aula</th>
                      <th style="text-align:center;">Stato</th>
                      <th style="text-align:center;">Dettagli</th>
                      
                  </tr>
              </thead>
              <tbody>                                                                                         
                <tr *ngFor="let t of tickets;let i = index;"> 
                  <td style="text-align:center;"> {{ t.id }} </td>
                  <td style="text-align:center;"> {{ t.date  | date: 'dd/MM/yyyy HH:mm'  }} </td> 
                  <td style="text-align:center;"><b>{{ t.title }}</b></td>
                  <td style="text-align:center;"> {{ t.classroom.building.name }} </td>
                  <td style="text-align:center;"> {{ t.classroom.name }} </td> 
                  <td style="text-align:center;"> {{ t.ticketStatus.description }} </td>
                  <td style="text-align:center;"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/searchicon.png" alt="Visualizza" height="30" width="30" onclick="" /></a></td>
                  <td  *ngIf="t.ticketmessages.length%2===0" style="text-align:center"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/exlam.png" height="30" width="30" onclick=""  /></a></td>
                </tr>
              </tbody>
          </table>
          <div class="col-sm-14">
                <button type="button" class="btn btn-success float-right" (click)="openNewTicket()">
                    Apri Nuova Segnalazione
                </button>
                </div>
 </div>
 </div>

<div *ngIf="newTicket" class="card card-body mb-3 bg-transparent" style="padding-top: 70px; border: transparent">
    <div class="card card-body mb-3" style=" border-color:darkgray;
    box-shadow: 10px 10px 5px #aaaaaa;     ">
        <h3>Apri una Segnalazione</h3>
        <br>
        <form>
            <div class="form-group row">
                <label for="laurea" class="col-sm-2 col-form-label">Titolo</label>
                <div class="col-sm-10">
                    <input type="text" id="title" class="form-control" placeholder="Titolo" #title>
                </div>
            </div>
            <div class="form-group row">
                <label for="nome" class="col-sm-2 col-form-label">Edificio</label>
                <div class="col-sm-10">
                  <select class="custom-select mr-sm-2" name="nome" #building (change)="onChange($event, building.value)">
                    <option value=0>Seleziona Edificio</option>
                    <option *ngFor="let b of buildings; let b = index" [value]="b.id">{{ b.name }}</option>
                  </select>
                </div>
              </div>
            <div class="form-group row">
              <label for="nome" class="col-sm-2 col-form-label" >Aula</label>
              <div class="col-sm-10">
                <select class="custom-select mr-sm-2" name="nome" #classroom (change)="onChange2($event, classroom.value)">
                  <option value=0>Seleziona Aula</option>
                  <option *ngFor="let c of filteredclassrooms; let c = index" [value]="c.id">{{ c.name }}</option>
                </select>
                <div *ngIf="showOthers" class="row">
                        <div class="col-sm-12">
                        <button type="button" class="btn btn-dark float-right" (click)="classroomTickets(classroom.value)" data-toggle="modal" data-target="#modal">Segnalazioni gi√† aperte</button>
                    </div>
                    </div>
              </div>
             
            </div>
            <div class="form-group row">
              <label for="academicyear" class="col-sm-2 col-form-label">Messaggio</label>
              <div class="col-sm-10">
                <textarea class="form-control input-lg" rows="3" #textmessage></textarea> 
            </div>
          </div>
          <div class="form-group row">
                <div class="col-md-12">
                <button type="button" class="btn btn-dark" (click)="back()">Indietro</button>
            <button type="button" class="btn btn-success float-right" (click)="send(title.value, classroom.value, textmessage.value)">Invia</button>
        </div>        
        </div>
</form>
    </div>
</div>

<div *ngIf="archivedTeacher" class="card card-body mb-3 bg-transparent" style="padding-top: 70px; border: transparent">
    <div class="card card-body mb-3" style=" border-color:darkgray;
  box-shadow: 10px 10px 5px #aaaaaa;   ">
    <h3>Segnalazioni Archiviate</h3>
    <div class="col-sm-14">
      <button type="button" class="btn btn-dark float-right" style="float: right;" (click)="ngOnInit()">
          Indietro
      </button>
    </div>
<table id="elencoarchivedtickets"  class="table table-hover dt-responsive" cellspacing="0" width="100%">                                       
      <thead>
              <tr>
                  <th style="text-align:center;" class="never">Numero</th>
                  <th style="text-align:center;">Data apertura</th>
                  <th style="text-align:center;">Titolo</th>
                  <th style="text-align:center;">Edificio</th>
                  <th style="text-align:center;">Aula</th>
                  <th style="text-align:center;">Stato</th>
                  <th style="text-align:center;">Dettagli</th>
              </tr>
          </thead>
          <tbody>                                                                                         
                  <tr *ngFor="let t of filteredteachertickets"> 
                    <td style="text-align:center;"> {{ t.id }} </td>
                    <td style="text-align:center;"> {{ t.date  | date: 'dd/MM/yyyy HH:mm'  }} </td> 
                    <td style="text-align:center;"><b> {{ t.title }} </b></td>
                    <td style="text-align:center;"> {{ t.classroom.building.name }} </td>
                    <td style="text-align:center;"> {{ t.classroom.name }} </td>
                    <td style="text-align:center;"> {{ t.ticketStatus.description }} </td>
                    <td style="text-align:center;"><a routerLink="ticket/{{t.id}}"><img src="http://localhost:8080/SpringApp/images/searchicon.png" alt="Visualizza" height="30" width="30" onclick="" /></a></td>
                  </tr>
                </tbody>
  </table>
  </div>
</div>


 <!-- Modal -->
 <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Segnalazioni Aperte Aula {{selectedClass?.name}}</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                    <table class="table table-hover dt-responsive" cellspacing="0" width="100%">
                            <thead>
                                    <tr>
                                        <th style="text-align:center;">Data apertura</th>
                                        <th style="text-align:center;">Titolo</th>
                                        <th style="text-align:center;">Docente</th>
                                        <th style="text-align:center;">Contenuto</th>
                                    </tr>
                                </thead>
                                <tbody>                                                                                         
                                        <tr *ngFor="let t of thisclassroomtickets"> 
                                          <td style="text-align:center;"> {{ t.date  | date: 'dd/MM/yyyy HH:mm'  }} </td> 
                                          <td style="text-align:center;"><b> {{ t.title }} </b></td>
                                          <td style="text-align:center;"> {{ t?.teacher.surname }} {{ t?.teacher.name }}  </td> 
                                          <td style="text-align:center;"> {{ t?.ticketmessages[0].text }} </td> 
                                        </tr>
                                      </tbody>
                        </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
            </div>
          </div>
        </div>
      </div>
    
</body>